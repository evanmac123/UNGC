<script>
$(function () { 
	$("#tree").tree({
     ui: {
       dots: false,
       theme_name: 'apple'
     },
		data : { 
			type : "json",
			opts : {
				url : "/admin/pages.json"
			}
		},
		types: {
		  'page': {
		    'icon': {
		      'image': '/assets/page_white.png'
		    }
		  },
		  'section': {
		    'icon': {
		      'image': '/assets/folder.png'
		    }
		  }
		},
    callback: {
      check_move: function(node, ref_node, type, tree_obj) {
        var ref_type = tree_obj.get_type(ref_node);
        var node_type = tree_obj.get_type(node);
        if (node_type == 'page') {
          if (ref_type == 'section' && type != 'inside')
            return false;
        } else if (node_type == 'section') {
          if (type == 'inside' || ref_type == 'page')
            return false;
        }
      },
      ondblclk: function(node, tree) {
        $.tree.focused().rename();
        // console.log("double clicked dood!");
      },
      oncreate: function(node, ref_node, type, tree_obj, rollback) {
        if ($(node).attr('rel') != 'section') {
          Page.newPageCreated(node, ref_node, type, tree_obj);
        }
      },
      onload: function(tree) { $('.loading').removeClass('loading'); },
      onrename: function(node, tree, rollback) { Treeview.onrename(node, tree, rollback) },
      onselect: function(node, tree) { Treeview.onselect(node, tree) }
     }
	});
});
</script>
