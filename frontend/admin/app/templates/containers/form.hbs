<form class="form-horizontal">
  <fieldset>
    <legend>
      {{#if model.layouts}}
        Create Page
      {{else}}
        Edit Page
      {{/if}}
    </legend>

    {{#if model.layouts}}
      <div class="form-group">
        <label for="layout" class="control-label col-sm-2">
          Layout
        </label>
        <div class="col-sm-10">
          {{fast-select
            items=model.layouts
            selected=model.container.layoutRecord
            labelPath="label"
            valuePath="id"
            class="form-control"
            id="layout"}}
        </div>
      </div>
    {{/if}}
  </fieldset>

  {{#container/x-subform record=model.container as |form|}}
    {{partial form.subformTemplatePath}}
  {{/container/x-subform}}

  <fieldset>
    <legend>Actions</legend>
    <div class="form-group">
      <div class="col-sm-offset-2 col-sm-10">
        <button class="btn btn-primary" {{action "saveDraft" model.container}}>
          {{#if model.layouts}}
            Create
          {{else}}
            Save
          {{/if}}
        </button>

        {{#if model.container.id}}
          <button class="btn btn-success" {{action "publish" model.container}}>
            Publish
          </button>
        {{/if}}

        <a target="_blank" href="{{model.container.publicPath}}?draft=1">
          Preview
        </a>
      </div>
    </div>
  </fieldset>

  {{#if model.payloads}}
    <fieldset>
      <legend>History</legend>
      <table class="table table-striped">
        <tbody>
          {{#each model.payloads as |payload|}}
            <tr>
              <td>{{ago payload.createdAt}}</td>
              <td>
                <a target="_blank" href="{{model.container.publicPath}}?payload={{payload.id}}">
                  View
                </a>
              </td>
              <td>
                <button class="btn btn-default" {{action "setDraftFromPayload" payload}}>
                  Set As Draft
                </button>
              </td>
            </tr>
          {{/each}}
        </tbody>
      </table>
    </fieldset>
  {{/if}}
</form>
