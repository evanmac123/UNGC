#!/usr/bin/env ruby
# encoding: utf-8
ENV['RAILS_ENV'] = ARGV.first || ENV['RAILS_ENV'] || 'development'  
require File.dirname(__FILE__) + '/../config/environment' unless defined?(RAILS_ROOT)
require 'hpricot'
require 'pp'
require 'facets'
require 'import_helper'
require 'ruby-debug' if Rails.env == 'development'

# Abbreviate long section names, so we can use them as CSS selectors
SHORTS = {
  'Human Rights' => 'human_rights',
  'Labour' => 'labour',
  'Environment' => 'environment',
  'Anti-Corruption' => 'anti_corruption',
  'Business and Peace' => 'business_peace',
  'Financial Markets' => 'financial',
  'Partnerships for Development' => 'partnerships',
  'UN/Business Partnerships' => 'un_business'
}

# Points to the unglobalcompact directory of the CMS export
root = "#{RAILS_ROOT}/vendor/open_cms_export/unglobalcompact/"

Navigation.delete_all          # Reset to 0
parse_language_nav(root)       # Language pages have their own navigation that isn't well integrated
parse_sitenav_nav(root)        # Likewise, the 'WebsiteInfo' section - contact us, etc.
parse_regular_nav(root)        # For everything else

ContentVersion.delete_all # reset to 0
Content.delete_all
files = get_files_from(root)

files.each do |filename|
  puts "Reading from '#{filename - root}'"
  read_and_write_content(root, filename)
end

manually_adjust_shorts 
